@{
    ViewData["Title"] = "Đặt Hàng";
    var customer = ViewBag.Customer as Exe_Demo.Models.Customer;
    var cartItems = ViewBag.CartItems as List<Exe_Demo.Models.Cart>;
    var total = ViewBag.Total as decimal?;
}

<style>
    .billing-heading {
        color: #4f6a4c;
        font-weight: 700;
        margin-bottom: 30px;
    }
    
    .form-control:focus {
        border-color: #4f6a4c;
        box-shadow: 0 0 0 0.2rem rgba(79, 106, 76, 0.25);
    }
    
    .cart-total {
        background: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #4f6a4c;
    }
    
    .btn-primary {
        background: #4f6a4c;
        border-color: #4f6a4c;
    }
    
    .btn-primary:hover {
        background: #3d5239;
        border-color: #3d5239;
    }
</style>

@{ await Html.RenderPartialAsync("_PageHero", ("Đặt Hàng", "Trang chủ", Url.Action("Index", "Home"), "Giỏ hàng", Url.Action("Index", "Cart"))); }

<section class="ftco-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-10 ftco-animate">
                <form asp-action="PlaceOrder" asp-controller="Cart" method="post" id="checkoutForm">
                    <h3 class="billing-heading">Thông Tin Giao Hàng</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Họ và tên <span class="text-danger">*</span></label>
                                <input type="text" name="FullName" class="form-control" value="@customer.FullName" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Số điện thoại <span class="text-danger">*</span></label>
                                <input type="tel" name="Phone" class="form-control" value="@customer.PhoneNumber" required>
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="Email" class="form-control" value="@customer.Email">
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Địa chỉ giao hàng <span class="text-danger">*</span></label>
                                <textarea name="Address" class="form-control" rows="3" required>@customer.Address</textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Ghi chú đơn hàng (tùy chọn)</label>
                                <textarea name="Note" class="form-control" rows="3" placeholder="Ghi chú về đơn hàng, ví dụ: thời gian hay chỉ dẫn địa điểm giao hàng chi tiết hơn."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-5">
                        <div class="col-md-6">
                            <div class="cart-total p-4">
                                <h3 class="billing-heading">Đơn Hàng Của Bạn</h3>
                                <hr>
                                @foreach (var item in cartItems)
                                {
                                    <p class="d-flex justify-content-between">
                                        <span>@item.Product.ProductName x @item.Quantity</span>
                                        <span>@((item.Quantity * item.Product.Price).ToString("N0")) đ</span>
                                    </p>
                                }
                                <hr>
                                <p class="d-flex justify-content-between">
                                    <span>Tạm tính</span>
                                    <span>@total.Value.ToString("N0") đ</span>
                                </p>
                                <p class="d-flex justify-content-between">
                                    <span>Phí vận chuyển</span>
                                    <span>Miễn phí</span>
                                </p>
                                <hr>
                                <p class="d-flex justify-content-between" style="font-size: 20px; font-weight: 700; color: #4f6a4c;">
                                    <span>Tổng cộng</span>
                                    <span>@total.Value.ToString("N0") đ</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="cart-total p-4">
                                <h3 class="billing-heading">Phương Thức Thanh Toán</h3>
                                <hr>
                                <div class="form-group">
                                    <div class="custom-control custom-radio">
                                        <input type="radio" id="cod" name="PaymentMethod" value="COD" class="custom-control-input" checked>
                                        <label class="custom-control-label" for="cod">
                                            <strong>Thanh toán khi nhận hàng (COD)</strong>
                                            <p class="text-muted small mb-0">Thanh toán bằng tiền mặt khi nhận hàng</p>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="custom-control custom-radio">
                                        <input type="radio" id="bank" name="PaymentMethod" value="Bank" class="custom-control-input">
                                        <label class="custom-control-label" for="bank">
                                            <strong>Chuyển khoản ngân hàng</strong>
                                            <p class="text-muted small mb-0">Chuyển khoản trực tiếp vào tài khoản ngân hàng</p>
                                        </label>
                                    </div>
                                </div>
                                
                                <hr>
                                
                                <div class="form-group">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="terms" required>
                                        <label class="custom-control-label" for="terms">
                                            Tôi đã đọc và đồng ý với <a href="#" style="color: #4f6a4c;">điều khoản và điều kiện</a> <span class="text-danger">*</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-block py-3 mt-3">
                                    <i class="fa fa-check-circle"></i> Đặt Hàng
                                </button>
                                
                                <a href="@Url.Action("Index", "Cart")" class="btn btn-outline-secondary btn-block py-3 mt-2">
                                    <i class="fa fa-arrow-left"></i> Quay Lại Giỏ Hàng
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function(){
            $('#checkoutForm').submit(function(e){
                if(!$('#terms').is(':checked')) {
                    e.preventDefault();
                    alert('Vui lòng đồng ý với điều khoản và điều kiện!');
                    return false;
                }
            });
        });
    </script>
}
