@model Exe_Demo.Models.ViewModels.OrderManagementViewModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω ƒë∆°n h√†ng";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-md-6">
            <h2>Qu·∫£n L√Ω ƒê∆°n H√†ng</h2>
        </div>
        <div class="col-md-6 text-end">
            <a asp-action="ExportOrders" class="btn btn-success me-2">
                <i class="fa fa-file-excel-o"></i> Xu·∫•t/Nh·∫≠p Excel
            </a>
            <a asp-action="Dashboard" class="btn btn-outline-secondary">
                <i class="fa fa-arrow-left"></i> Quay l·∫°i
            </a>
        </div>
    </div>

    <!-- B·ªô l·ªçc -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="get" asp-action="Orders">
                <div class="row g-3">
                    <div class="col-md-3">
                        <input type="text" name="search" class="form-control" 
                               placeholder="T√¨m m√£ ƒë∆°n, t√™n, SƒêT..." value="@Model.SearchTerm">
                    </div>
                    <div class="col-md-2">
                        <select name="status" class="form-select">
                            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="Ch·ªù x√°c nh·∫≠n" selected="@(Model.StatusFilter == "Ch·ªù x√°c nh·∫≠n")">Ch·ªù x√°c nh·∫≠n</option>
                            <option value="ƒêang x·ª≠ l√Ω" selected="@(Model.StatusFilter == "ƒêang x·ª≠ l√Ω")">ƒêang x·ª≠ l√Ω</option>
                            <option value="ƒêang giao" selected="@(Model.StatusFilter == "ƒêang giao")">ƒêang giao</option>
                            <option value="ƒê√£ ho√†n th√†nh" selected="@(Model.StatusFilter == "ƒê√£ ho√†n th√†nh")">ƒê√£ ho√†n th√†nh</option>
                            <option value="ƒê√£ h·ªßy" selected="@(Model.StatusFilter == "ƒê√£ h·ªßy")">ƒê√£ h·ªßy</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select name="paymentStatus" class="form-select">
                            <option value="">Thanh to√°n</option>
                            <option value="Ch∆∞a thanh to√°n" selected="@(Model.PaymentStatusFilter == "Ch∆∞a thanh to√°n")">Ch∆∞a thanh to√°n</option>
                            <option value="ƒê√£ thanh to√°n" selected="@(Model.PaymentStatusFilter == "ƒê√£ thanh to√°n")">ƒê√£ thanh to√°n</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="date" name="fromDate" class="form-control" 
                               value="@Model.FromDate?.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="col-md-2">
                        <input type="date" name="toDate" class="form-control" 
                               value="@Model.ToDate?.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Danh s√°ch ƒë∆°n h√†ng -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                    <thead style="background: #4f6a4c; color: white;">
                        <tr>
                            <th style="font-size: 15px; padding: 15px;">M√£ ƒê∆°n</th>
                            <th style="font-size: 15px; padding: 15px;">Kh√°ch H√†ng</th>
                            <th style="font-size: 15px; padding: 15px;">SƒêT</th>
                            <th style="font-size: 15px; padding: 15px;">T·ªïng Ti·ªÅn</th>
                            <th style="font-size: 15px; padding: 15px; text-align: center;">Thanh To√°n</th>
                            <th style="font-size: 15px; padding: 15px; text-align: center;">Tr·∫°ng Th√°i</th>
                            <th style="font-size: 15px; padding: 15px;">Ng√†y ƒê·∫∑t</th>
                            <th style="font-size: 15px; padding: 15px; text-align: center;">Chi Ti·∫øt</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.Orders)
                        {
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 15px; font-size: 14px;">
                                    <strong style="color: #4f6a4c;">@order.OrderCode</strong>
                                </td>
                                <td style="padding: 15px; font-size: 14px;">
                                    <strong>@order.CustomerName</strong>
                                </td>
                                <td style="padding: 15px; font-size: 14px;">
                                    @order.CustomerPhone
                                </td>
                                <td style="padding: 15px; font-size: 16px;">
                                    <strong style="color: #d9534f;">@order.FinalAmount.ToString("N0") ƒë</strong>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    @if (order.PaymentStatus == "ƒê√£ thanh to√°n")
                                    {
                                        <span class="badge bg-success" style="font-size: 13px; padding: 8px 15px;">‚úì ƒê√£ thanh to√°n</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger" style="font-size: 13px; padding: 8px 15px;">‚úó Ch∆∞a thanh to√°n</span>
                                    }
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    @if (order.OrderStatus == "ƒê√£ ho√†n th√†nh")
                                    {
                                        <span class="badge bg-success" style="font-size: 13px; padding: 8px 15px;">‚úì Ho√†n th√†nh</span>
                                    }
                                    else if (order.OrderStatus == "Ch·ªù x·ª≠ l√Ω")
                                    {
                                        <span class="badge bg-warning text-dark" style="font-size: 13px; padding: 8px 15px;">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
                                    }
                                    else if (order.OrderStatus == "ƒêang x·ª≠ l√Ω")
                                    {
                                        <span class="badge bg-info" style="font-size: 13px; padding: 8px 15px;">üîÑ ƒêang x·ª≠ l√Ω</span>
                                    }
                                    else if (order.OrderStatus == "ƒêang giao")
                                    {
                                        <span class="badge bg-primary" style="font-size: 13px; padding: 8px 15px;">üöö ƒêang giao</span>
                                    }
                                    else if (order.OrderStatus == "ƒê√£ h·ªßy")
                                    {
                                        <span class="badge bg-danger" style="font-size: 13px; padding: 8px 15px;">‚úó ƒê√£ h·ªßy</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary" style="font-size: 13px; padding: 8px 15px;">@order.OrderStatus</span>
                                    }
                                </td>
                                <td style="padding: 15px; font-size: 14px;">
                                    @order.CreatedDate?.ToString("dd/MM/yyyy")<br>
                                    <small class="text-muted">@order.CreatedDate?.ToString("HH:mm")</small>
                                </td>
                                <td style="padding: 15px; text-align: center;">
                                    <a asp-action="OrderDetail" asp-route-id="@order.OrderId" 
                                       class="btn btn-primary" style="padding: 8px 20px; font-size: 14px;" title="Xem chi ti·∫øt">
                                        <i class="fa fa-eye"></i> Xem
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        @if (Model.TotalPages > 1)
        {
            <div class="card-footer bg-white">
                <nav>
                    <ul class="pagination justify-content-center mb-0">
                        @if (Model.CurrentPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" asp-action="Orders" 
                                   asp-route-page="@(Model.CurrentPage - 1)"
                                   asp-route-search="@Model.SearchTerm"
                                   asp-route-status="@Model.StatusFilter"
                                   asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                   asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                   asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">Tr∆∞·ªõc</a>
                            </li>
                        }

                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link" asp-action="Orders" 
                                   asp-route-page="@i"
                                   asp-route-search="@Model.SearchTerm"
                                   asp-route-status="@Model.StatusFilter"
                                   asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                   asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                   asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">@i</a>
                            </li>
                        }

                        @if (Model.CurrentPage < Model.TotalPages)
                        {
                            <li class="page-item">
                                <a class="page-link" asp-action="Orders" 
                                   asp-route-page="@(Model.CurrentPage + 1)"
                                   asp-route-search="@Model.SearchTerm"
                                   asp-route-status="@Model.StatusFilter"
                                   asp-route-paymentStatus="@Model.PaymentStatusFilter"
                                   asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
                                   asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")">Sau</a>
                            </li>
                        }
                    </ul>
                </nav>
            </div>
        }
    </div>
</div>
